<div class="panel grid">
  <div class="title-panel">
    <h1 class="drill-title"><%= @drill.title.presence || "無題" %></h1>
  </div>
  <div class="drill-guide"><%= simple_format(h(@drill.guide.presence || "説明文なし")) %></div>
  <%= image_tag @drill.user.icon_path, size: '56x56', alt: 'icon', class: 'a-user-icon' %>
  <div class="drill-use"><%= link_to @drill.user, @drill.user, class: "drill-user-name" %></div>

  <div class="drill-problem-count">
    このドリルの問題数: <%= problems_count = @drill.problems.size %>
    <br>
    <% if current_user %>
     習得問題数: <%= @drill_user_result&.number_of_problem_mastered || "-" %>
     <% if @driill_is_mastered %>
       習得済み
     <% end %>
    <% end %>
  </div>

  <%= form_with url: "/solve/#{@drill.id}", method: "GET", class: "solve-drill-form" do |f| %>
    <div class="drill-option">
      <%= f.label :rand, "ランダムに出題する", class: "label"%>
      <%= f.check_box :rand, {checked: true, class: "random-option"}, "true", nil %>

      <% unless @driill_is_mastered %>
        <%= f.label :past, "過去の回答に基づいて出題する", class: "label"%>
        <%= f.check_box :past, {checked: true, class: "random-option"}, "true", nil %>
      <% end %>
    </div>

    <div class="drill-option">
      <div class="label problem-number-option-label">問題数: </div>
      <%= f.select :num,  options_for_select(problem_count_select_list(problems_count)), {}, class: "problem-number-option" %>
    </div>

    <div class="btn-box">
      <%= f.submit t("text.Solve_problems"), name: '', class: 'btn-std btn-big solve-btn' %>
    </div>
  <% end %>

  <%= @drill %>

  <% if current_user == @drill.user ||  %>
    <hr>
    <div style="font-size: 8">
      <%= link_to "編集する", edit_drill_path(@drill) %>
    </div>
  <% elsif current_user&.admin? %>
    <hr>
    <div style="font-size: 8">
    <%= link_to "管理者編集", edit_drill_path(@drill) %>
    </div>
  <% end %>
  <% if current_user&.admin? %>
    <%= link_to "problems", drill_problems_path(@drill) %>
  <% end %>
</div>

<% if current_user %>
  <% if DrillLike.exists?(user: current_user, drill: @drill) %>
    <%= form_with(model: current_user.drill_likes.find_by(drill_id: @drill.id), html: { method: :delete }, local: true) do |f| %>
      <%= f.submit "Unlike", class: "btn btn-primary" %>
    <% end %>
  <% else %>
    <%= form_with(model: current_user.drill_likes.build, remote: true) do |f| %>
      <div><%= hidden_field_tag :drill_id, @drill.id %></div>
      <%= f.submit "Like", class: "btn btn-primary" %>
    <% end %>
  <% end %>
<% end %>

<%# @drill.problems.relation %>
